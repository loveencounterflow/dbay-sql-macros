{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'DBAY-SQL-MACROS'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\n{ equals }                = GUY.samesame\n# new_xregex                = require 'xregexp'\n# E                         = require '../../../apps/dbay/lib/errors'\nsql_lexer                 = require 'dbay-sql-lexer'\nrx                        = require './regexes'\nLTSORT                    = require 'ltsort'\n\n\n#-----------------------------------------------------------------------------------------------------------\n#\n#===========================================================================================================\nclass DBay_sqlm_error extends Error\n  constructor: ( ref, message ) ->\n    super()\n    @message  = \"#{ref} (#{@constructor.name}) #{message}\"\n    @ref      = ref\n    return undefined ### always return `undefined` from constructor ###\n\n#===========================================================================================================\nclass DBay_sqlm_internal_error            extends DBay_sqlm_error\n  constructor: ( ref, message )     -> super ref, message\nclass DBay_sqlm_unknown_macro_error       extends DBay_sqlm_error\n  constructor: ( ref, name )        -> super ref, \"unknown macro #{rpr name}\"\nclass DBay_sqlm_recursion_level_error       extends DBay_sqlm_error\n  constructor: ( ref, max_level )   -> super ref, \"maximum recursion depth of #{max_level} reached\"\nclass DBay_sqlm_circular_references_error   extends DBay_sqlm_error\n  constructor: ( ref, name, ref_name ) -> super ref, \\\n    \"detected circular references in macro #{rpr name}() referencing #{rpr ref_name}()\"\nclass DBay_sqlm_unknown_parameters_error       extends DBay_sqlm_error\n  constructor: ( ref, names )        -> super ref, \"unknown parameters #{( rpr n for n from names ).join ', '}\"\nclass DBay_sqlm_duplicate_parameters_error     extends DBay_sqlm_error\n  constructor: ( ref, names )        -> super ref, \"duplicate parameters #{( rpr n for n from names ).join ', '}\"\nclass DBay_sqlm_arity_error               extends DBay_sqlm_error\n  constructor: ( ref, name, declaration_arity, call_arity, source, values ) ->\n    super ref, \"\"\"\n      expected #{declaration_arity} arguments in call to macro #{rpr name}, got #{call_arity};\n      source: #{rpr source},\n      values: #{rpr values}\"\"\"\nclass DBay_sqlm_TOBESPECIFIED_error       extends DBay_sqlm_error\n  constructor: ( ref, message )     -> super ref, message\n\n\n#-----------------------------------------------------------------------------------------------------------\n#\n#===========================================================================================================\nclass DBay_sqlx # extends ( require H.dbay_path ).DBay\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    GUY.props.hide @, 'types',          ( require './types' )()\n    GUY.props.hide @, '_declarations',  {}\n    GUY.props.hide @, '_topograph',     LTSORT.new_graph { loners: true, }\n    @cfg = @types.create.dbm_constructor_cfg cfg\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  declare: ( sqlx ) =>\n    @types.validate.nonempty.text sqlx\n    parameters_re               = null\n    #.......................................................................................................\n    unless ( match = sqlx.match @cfg._start_paren_name_re )?\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@1^', \"syntax error in #{rpr sqlx}\"\n    name                        = match[ 0 ]\n    position                    = match.index + name.length\n    #.......................................................................................................\n    parameters_re               = /\\(\\s*(?<parameters>[^)]*?)\\s*\\)\\s*=\\s*/yu\n    parameters_re.lastIndex     = position\n    unless ( match = sqlx.match parameters_re )?\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@2^', \"syntax error in #{rpr sqlx}\"\n    { parameters, }             = match.groups\n    parameters                  = parameters.split /\\s*,\\s*/u\n    parameters                  = [] if equals parameters, [ '', ]\n    unless @types.isa.dbm_parameter_list parameters\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@2^', \\\n        \"syntax error in parameters of declaration #{rpr sqlx}\"\n    #.......................................................................................................\n    current_idx                 = parameters_re?.lastIndex\n    throw new DBay_sqlm_internal_error '^dbay/dbm@3^', \"current_idx has not been set\" unless current_idx?\n    body                        = sqlx[ current_idx ... ].replace /\\s*;\\s*$/u, ''\n    arity                       = parameters.length\n    @_declare { name, parameters, arity, body, }\n  #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _declare: ( cfg ) ->\n    if @_declarations[ cfg.name ]?\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@4^', \"can not re-declare #{rpr cfg.name}\"\n    @_validate_parameters cfg.parameters, cfg.body\n    @_validate_cycles cfg.name, cfg.body\n    ### TAINT use `@cfg.vanisher` instead of `|` ###\n    cfg.parameter_res           = ( rx.get_rx_for_parameter @cfg, p for p in cfg.parameters )\n    @_declarations[ cfg.name ]  = cfg\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _validate_parameters: ( declared_parameters, body ) ->\n    #.......................................................................................................\n    counts                = {}\n    counts[ p ]           = ( counts[ p ] ?= 0 ) + 1 for p in declared_parameters\n    duplicate_parameters  = ( p for p, count of counts when count > 1 )\n    if duplicate_parameters.length isnt 0\n      throw new DBay_sqlm_duplicate_parameters_error '^dbay/dbm@4^', duplicate_parameters\n    #.......................................................................................................\n    used_parameters       = ( body.match @cfg._bare_name_re ) ? []\n    unknown_parameters    = ( p for p in used_parameters when p not in declared_parameters )\n    if unknown_parameters.length isnt 0\n      throw new DBay_sqlm_unknown_parameters_error '^dbay/dbm@4^', unknown_parameters\n    #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _validate_cycles: ( name, body ) ->\n    ref_names = ( body.match @cfg._paren_name_re ) ? []\n    LTSORT.add @_topograph, name\n    for ref_name in ref_names\n      LTSORT.add @_topograph, name, ref_name\n      try dependencies = LTSORT.group @_topograph catch error\n        throw error unless ( error.message.match /detected cycle involving node/ )?\n        throw new DBay_sqlm_circular_references_error '^dbay/dbm@4^', name, ref_name\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  resolve: ( sqlx ) => @_resolve sqlx, 0, new Set()\n\n  #---------------------------------------------------------------------------------------------------------\n  _resolve: ( sqlx, level ) =>\n    @types.validate.nonempty.text sqlx\n    R         = []\n    position  = 0\n    pnre      = @cfg._paren_name_re\n    count     = 0\n    max_level = 50\n    #.......................................................................................................\n    if level > max_level\n      throw new DBay_sqlm_recursion_level_error '^dbay/dbm@4^', max_level\n    #.......................................................................................................\n    loop\n      pnre.lastIndex  = position\n      match           = pnre.exec sqlx\n      # debug '^57-1^', match\n      break unless match?\n      R.push sqlx[ position ... match.index ]\n      name            = match[ 0 ]\n      #.....................................................................................................\n      unless ( declaration = @_declarations[ name ] )?\n        throw new DBay_sqlm_unknown_macro_error '^dbay/dbm@5^', name\n      #.....................................................................................................\n      position        = match.index + name.length\n      tail            = sqlx[ position ... ]\n      # urge '^57-1^', { name, position, tail, }, R\n      #.....................................................................................................\n      { body }        = declaration\n      { values\n        stop_idx  }   = @_find_arguments tail\n      call_arity      = values.length\n      #.....................................................................................................\n      unless call_arity is declaration.arity\n        source = sqlx[ match.index ... position + stop_idx ]\n        throw new DBay_sqlm_arity_error '^dbay/dbm@6^', name, declaration.arity, call_arity, source, values\n      #.....................................................................................................\n      # help '^56-2^', ( rpr tail ), '->', GUY.trm.reverse GUY.trm.steel values\n      for value, value_idx in values\n        value = @_resolve value, level + 1 if ( value.match pnre )?\n        ### NOTE using a function to avoid accidental replacement semantics ###\n        body  = body.replace declaration.parameter_res[ value_idx ], => value\n      #.....................................................................................................\n      body      = @_resolve body, level + 1 if ( body.match pnre )?\n      R.push body\n      position += stop_idx\n      count++\n    #.......................................................................................................\n    R.push sqlx[ position ... ] if 0 < position <= sqlx.length\n    # R = R.join 'â–ˆ'\n    R = R.join ''\n    #.....................................................................................................\n    ### NOTE using a function to avoid accidental replacement semantics ###\n    R = sqlx if count is 0\n    R = R.replace @cfg._escaped_prefix_re, => @cfg.prefix if level is 0\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  _find_arguments: ( sqlx ) ->\n    unless sqlx[ 0 ] is '('\n      throw new DBay_sqlm_internal_error '^dbay/dbm@7^', \"source must start with left bracket, got #{rpr sqlx}\"\n    sqlx    = sqlx.trim()\n    values  = []\n    R       = { values, stop_idx: null, }\n    #.......................................................................................................\n    level       = 0\n    comma_idxs  = [ { start: null, stop: 1, }, ]\n    do_break    = false\n    for token in sql_lexer.tokenize sqlx\n      switch token.type\n        when 'left_paren'\n          level++\n        when 'right_paren'\n          level--\n          if level < 1\n            comma_idxs.push { start: token.idx, stop: null, }\n            do_break = true\n            break\n        when 'comma'\n          if level is 1\n            comma_idxs.push { start: token.idx, stop: token.idx + token.text.length, }\n        else\n          null\n      break if do_break\n    R.stop_idx = ( comma_idxs.at -1 ).start + 1 ### NOTE should be Unicode-safe b/c we know it's `)` ###\n    #.......................................................................................................\n    for idx in [ 1 ... comma_idxs.length ]\n      start = comma_idxs[ idx - 1 ].stop\n      stop  = comma_idxs[ idx     ].start\n      values.push sqlx[ start ... stop ].trim()\n    #.......................................................................................................\n    values.pop() if equals values, [ '', ]\n    return R\n\n\n############################################################################################################\nmodule.exports = { DBay_sqlx, DBay_sqlm_error, DBay_sqlm_TOBESPECIFIED_error, }\n"
  ]
}