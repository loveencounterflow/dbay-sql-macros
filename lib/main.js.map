{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'DBAY-SQL-MACROS'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\n{ equals }                = GUY.samesame\n# new_xregex                = require 'xregexp'\n# E                         = require '../../../apps/dbay/lib/errors'\nsql_lexer                 = require 'dbay-sql-lexer'\n\n\n#-----------------------------------------------------------------------------------------------------------\n#\n#===========================================================================================================\nclass DBay_sqlm_error extends Error\n  constructor: ( ref, message ) ->\n    super()\n    @message  = \"#{ref} (#{@constructor.name}) #{message}\"\n    @ref      = ref\n    return undefined ### always return `undefined` from constructor ###\n\n#===========================================================================================================\nclass DBay_sqlm_internal_error            extends DBay_sqlm_error\n  constructor: ( ref, message )     -> super ref, message\nclass DBay_sqlm_unknown_macro_error       extends DBay_sqlm_error\n  constructor: ( ref, name )        -> super ref, \"unknown macro #{rpr name}\"\nclass DBay_sqlm_arity_error               extends DBay_sqlm_error\n  constructor: ( ref, name, declaration_arity, call_arity, source, values ) ->\n    super ref, \"\"\"\n      expected #{declaration_arity} arguments in call to macro #{rpr name}, got #{call_arity};\n      source: #{rpr source},\n      values: #{rpr values}\"\"\"\nclass DBay_sqlm_TOBESPECIFIED_error       extends DBay_sqlm_error\n  constructor: ( ref, message )     -> super ref, message\n\n\n#-----------------------------------------------------------------------------------------------------------\n#\n#===========================================================================================================\nclass DBay_sqlx # extends ( require H.dbay_path ).DBay\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    GUY.props.hide @, 'types',          ( require './types' )()\n    GUY.props.hide @, '_declarations',  {}\n    @cfg = @types.create.dbm_constructor_cfg cfg\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  declare: ( sqlx ) =>\n    @types.validate.nonempty.text sqlx\n    parameters_re               = null\n    #.......................................................................................................\n    unless ( match = sqlx.match @cfg._start_paren_name_re )?\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@1^', \"syntax error in #{rpr sqlx}\"\n    name                        = match[ 0 ]\n    position                    = match.index + name.length\n    #.......................................................................................................\n    parameters_re               = /\\(\\s*(?<parameters>[^)]*?)\\s*\\)\\s*=\\s*/yu\n    parameters_re.lastIndex     = position\n    unless ( match = sqlx.match parameters_re )?\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@2^', \"syntax error in #{rpr sqlx}\"\n    { parameters, }             = match.groups\n    parameters                  = parameters.split /\\s*,\\s*/u\n    parameters                  = [] if equals parameters, [ '', ]\n    @types.validate.dbm_parameter_list parameters\n    #.......................................................................................................\n    current_idx                 = parameters_re?.lastIndex\n    throw new DBay_sqlm_internal_error '^dbay/dbm@3^', \"current_idx has not been set\" unless current_idx?\n    body                        = sqlx[ current_idx ... ].replace /\\s*;\\s*$/u, ''\n    arity                       = parameters.length\n    @_declare { name, parameters, arity, body, }\n  #.......................................................................................................\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _declare: ( cfg ) ->\n    if @_declarations[ cfg.name ]?\n      throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@4^', \"can not re-declare #{rpr cfg.name}\"\n    cfg.parameter_res           = ( @_get_parameter_re p for p in cfg.parameters )\n    @_declarations[ cfg.name ]  = cfg\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  ### TAINT see https://shiba1014.medium.com/regex-word-boundaries-with-unicode-207794f6e7ed\n  for Unicode-compliant alternatives to the trailing `\\b`; OTOH we're dealing w/ mostly-ASCII SQL here ###\n  _get_parameter_re: ( parameter ) -> /// (?<! \\\\ ) #{GUY.str.escape_for_regex parameter} \\b ///gu\n\n  #---------------------------------------------------------------------------------------------------------\n  resolve: ( sqlx ) => @_resolve sqlx, 0\n\n  #---------------------------------------------------------------------------------------------------------\n  _resolve: ( sqlx, level ) =>\n    # whisper '---------------------------------'\n    # help '^56-1^', rpr sqlx\n    @types.validate.nonempty.text sqlx\n    R         = []\n    position  = 0\n    pnre      = @cfg._paren_name_re\n    #.......................................................................................................\n    loop\n      pnre.lastIndex  = position\n      match           = pnre.exec sqlx\n      # debug '^57-1^', match\n      break unless match?\n      R.push sqlx[ position ... match.index ]\n      name            = match[ 0 ]\n      #.....................................................................................................\n      unless ( declaration = @_declarations[ name ] )?\n        throw new DBay_sqlm_unknown_macro_error '^dbay/dbm@5^', name\n      #.....................................................................................................\n      position        = match.index + name.length\n      tail            = sqlx[ position ... ]\n      # urge '^57-1^', { name, position, tail, }, R\n      #.....................................................................................................\n      { body }        = declaration\n      { values\n        stop_idx  }   = @_find_arguments tail\n      call_arity      = values.length\n      #.....................................................................................................\n      unless call_arity is declaration.arity\n        source = sqlx[ match.index ... position + stop_idx ]\n        throw new DBay_sqlm_arity_error '^dbay/dbm@6^', name, declaration.arity, call_arity, source, values\n      #.....................................................................................................\n      # help '^56-2^', ( rpr tail ), '->', GUY.trm.reverse GUY.trm.steel values\n      for value, value_idx in values\n        value = @resolve value, level + 1 if ( value.match pnre )?\n        ### NOTE using a function to avoid accidental replacement semantics ###\n        body  = body.replace declaration.parameter_res[ value_idx ], => value\n      #.....................................................................................................\n      body      = @resolve body, level + 1 if ( body.match pnre )?\n      R.push body\n      position += stop_idx\n    #.......................................................................................................\n    R.push sqlx[ position ... ] if 0 < position <= sqlx.length\n    # R = R.join '█'\n    R = R.join ''\n    #.....................................................................................................\n    ### NOTE using a function to avoid accidental replacement semantics ###\n    R = R.replace @cfg._escaped_prefix_re, => @cfg.prefix if level is 0\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  XXXXXXXXXXXXXXXXXXX_resolve_old: ( sqlx ) =>\n    whisper '---------------------------------'\n    help '^56-1^', rpr sqlx\n    @types.validate.nonempty.text sqlx\n    sql_before                      = sqlx\n    position                        = 0\n    R                               = []\n    for match from sqlx.matchAll @cfg._paren_name_re\n      name      = match[ 0 ]\n      last_idx  = match.index + name.length\n      R.push sqlx[ position ... match.index ]\n      continue unless sqlx[ last_idx ] is '('\n      #.....................................................................................................\n      unless ( declaration = @_declarations[ name ] )?\n        throw new DBay_sqlm_unknown_macro_error '^dbay/dbm@5^', name\n      #.....................................................................................................\n      { body }        = declaration\n      tail            = sqlx[ last_idx ... ]\n      { values\n        stop_idx  }   = @_find_arguments tail\n      call_arity      = values.length\n      help '^56-2^', ( rpr tail ), '->', GUY.trm.reverse GUY.trm.steel values\n      #.....................................................................................................\n      unless call_arity is declaration.arity\n        throw new DBay_sqlm_TOBESPECIFIED_error '^dbay/dbm@6^', \"expected #{declaration.arity} argument(s), got #{call_arity}\"\n      #.....................................................................................................\n      for parameter_re, parameter_idx in declaration.parameter_res\n        ### TAINT must use lexer to make replacements ###\n        value = raw_value = values[ parameter_idx ]\n        value = @resolve value if ( value.match @cfg._paren_name_re )?\n        if value isnt raw_value then urge '^56-4^', ( rpr values[ parameter_idx ] ), '->', GUY.trm.reverse GUY.trm.green rpr value\n        whisper '^56-6^', rpr body\n        body  = body.replace parameter_re, value\n        # info '^56-5^', rpr R\n        debug '^56-6^', rpr body[ match.index ... ]\n        info '^56-6^', rpr body\n        # body = body.replace parameter_re, values[ parameter_idx ]\n      #.....................................................................................................\n      ### NOTE using a function to avoid [accidental replacement\n      semantics](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace) ###\n      body = body.replace @cfg._escaped_prefix_re, => @cfg.prefix\n      R.push body\n      R.push tail[ stop_idx .. ]\n    R = if R.length is 0 then sqlx else R.join ''\n    return @resolve R if ( R.match @cfg._paren_name_re )?\n    whisper '^56-1^', '******************************'\n    return R\n\n  #---------------------------------------------------------------------------------------------------------\n  _find_arguments: ( sqlx ) ->\n    unless sqlx[ 0 ] is '('\n      throw new DBay_sqlm_internal_error '^dbay/dbm@7^', \"source must start with left bracket, got #{rpr sqlx}\"\n    sqlx    = sqlx.trim()\n    values  = []\n    R       = { values, stop_idx: null, }\n    #.......................................................................................................\n    level       = 0\n    comma_idxs  = [ { start: null, stop: 1, }, ]\n    do_break    = false\n    for token in sql_lexer.tokenize sqlx\n      switch token.type\n        when 'left_paren'\n          level++\n        when 'right_paren'\n          level--\n          if level < 1\n            comma_idxs.push { start: token.idx, stop: null, }\n            do_break = true\n            break\n        when 'comma'\n          if level is 1\n            comma_idxs.push { start: token.idx, stop: token.idx + token.text.length, }\n        else\n          null\n      break if do_break\n    R.stop_idx = ( comma_idxs.at -1 ).start + 1 ### NOTE should be Unicode-safe b/c we know it's `)` ###\n    #.......................................................................................................\n    for idx in [ 1 ... comma_idxs.length ]\n      start = comma_idxs[ idx - 1 ].stop\n      stop  = comma_idxs[ idx     ].start\n      values.push sqlx[ start ... stop ].trim()\n    #.......................................................................................................\n    values.pop() if equals values, [ '', ]\n    return R\n\n\n############################################################################################################\nmodule.exports = { DBay_sqlx, DBay_sqlm_error, DBay_sqlm_TOBESPECIFIED_error, }\n"
  ]
}